{% extends "base.html" %}
{% block title %}My Dashboard - Local Job Connect{% endblock %}
{% block content %}
<div class="container" style="padding: 40px 0;">
    <div class="dashboard-header">
        <h1>Good {{ 'morning' if now.hour < 12 else 'afternoon' if now.hour < 18 else 'evening' }}, {{ current_user.full_name.split()[0] }}!</h1>
        <p>Welcome back to your job search dashboard</p>
        
        <div class="dashboard-stats">
            <div class="stat-card">
                <div class="stat-number">{{ applications|length }}</div>
                <div class="stat-label">Applications Sent</div>
                <div class="stat-change positive">
                    <i class="fas fa-arrow-up"></i> +2 this week
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ saved_jobs|length }}</div>
                <div class="stat-label">Saved Jobs</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ applications|selectattr('status', 'equalto', 'interview')|list|length }}</div>
                <div class="stat-label">Interviews</div>
                <div class="stat-change positive">
                    <i class="fas fa-calendar-check"></i> Scheduled
                </div>
            </div>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 32px; margin-top: 32px;">
        <div>
            <div style="background: var(--bg-white); padding: 32px; border-radius: 16px; box-shadow: var(--shadow-sm); margin-bottom: 32px;">
                <h2 style="font-size: 24px; font-weight: 700; margin-bottom: 20px;">
                    <i class="fas fa-file-upload"></i> Upload Resume
                </h2>
                <form method="POST" action="{{ url_for('upload_resume') }}" enctype="multipart/form-data" style="display: flex; gap: 12px; align-items: center;">
                    <input type="file" name="resume" accept=".pdf" required style="flex: 1; padding: 12px; border: 2px dashed var(--border-light); border-radius: 12px; cursor: pointer;">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-cloud-upload-alt"></i> Upload
                    </button>
                </form>
                <small style="color: var(--text-gray); margin-top: 8px; display: block;">PDF only. Max 3 resumes allowed.</small>
            </div>

            <div style="background: var(--bg-white); padding: 32px; border-radius: 16px; box-shadow: var(--shadow-sm);">
                <h2 style="font-size: 24px; font-weight: 700; margin-bottom: 24px;">
                    <i class="fas fa-briefcase"></i> My Applications
                </h2>
                
                {% if applications %}
                <div class="job-list">
                    {% for application in applications %}
                    <div class="job-card">
                        <div class="job-header">
                            <div style="display: flex; gap: 16px; align-items: start; flex: 1;">
                                <div class="job-company-logo">
                                    {{ application.job.employer.company_name[0] }}
                                </div>
                                <div style="flex: 1;">
                                    <h3 class="job-title">{{ application.job.title }}</h3>
                                    <p class="job-company">{{ application.job.employer.company_name }}</p>
                                    <p style="color: var(--text-gray); font-size: 14px; margin-top: 4px;">
                                        <i class="fas fa-calendar"></i> Applied {{ application.submitted_at.strftime('%B %d, %Y') }}
                                    </p>
                                </div>
                            </div>
                            <span class="badge badge-{{ 'success' if application.status == 'accepted' else 'info' if application.status == 'interview' else 'warning' }}">
                                <i class="fas fa-{{ 'check-circle' if application.status == 'accepted' else 'clock' }}"></i>
                                {{ application.status|replace('_', ' ')|title }}
                            </span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div style="text-align: center; padding: 60px 20px; color: var(--text-gray);">
                    <i class="fas fa-inbox" style="font-size: 48px; margin-bottom: 16px; opacity: 0.3;"></i>
                    <p style="font-size: 16px;">You haven't applied to any jobs yet</p>
                    <a href="{{ url_for('search_jobs') }}" class="btn btn-primary" style="margin-top: 20px;">
                        <i class="fas fa-search"></i> Browse Jobs
                    </a>
                </div>
                {% endif %}
            </div>
        </div>

        <div>
            <div style="background: var(--bg-white); padding: 24px; border-radius: 16px; box-shadow: var(--shadow-sm); margin-bottom: 24px;">
                <h3 style="font-size: 18px; font-weight: 700; margin-bottom: 16px;">
                    <i class="fas fa-heart"></i> Saved Jobs
                </h3>
                {% if saved_jobs %}
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    {% for saved in saved_jobs[:3] %}
                    <a href="{{ url_for('view_job', job_id=saved.job.id) }}" style="text-decoration: none; color: inherit; padding: 12px; border: 1px solid var(--border-light); border-radius: 8px; transition: all 0.2s;">
                        <div style="font-weight: 600; color: var(--text-dark); margin-bottom: 4px;">{{ saved.job.title }}</div>
                        <div style="font-size: 13px; color: var(--text-gray);">{{ saved.job.employer.company_name }}</div>
                    </a>
                    {% endfor %}
                </div>
                {% else %}
                <p style="color: var(--text-gray); text-align: center; padding: 20px;">No saved jobs yet</p>
                {% endif %}
            </div>

            <div style="background: linear-gradient(135deg, #3b82f6, #1e3a8a); padding: 24px; border-radius: 16px; color: white;">
                <h3 style="font-size: 18px; font-weight: 700; margin-bottom: 12px;">
                    <i class="fas fa-lightbulb"></i> Quick Tip
                </h3>
                <p style="font-size: 14px; line-height: 1.6; opacity: 0.95;">
                    Complete your profile and upload multiple versions of your resume tailored to different job types to increase your chances!
                </p>
            </div>
        </div>
    </div>
</div>

{% set now = namespace() %}
{% set now.hour = 14 %}
{% endblock %}